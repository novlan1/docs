import{_ as t,c as e,b as o,ag as i}from"./chunks/framework.CMjv3OHl.js";const m=JSON.parse('{"title":"小程序发布指南","description":"","frontmatter":{},"headers":[],"relativePath":"work/66.rd-platform-mp.md","filePath":"work/66.rd-platform-mp.md","lastUpdated":1757434547000}'),r={name:"work/66.rd-platform-mp.md"};function l(p,a,s,n,c,h){return o(),e("div",null,a[0]||(a[0]=[i(`<div class="info custom-block"><p class="custom-block-title">作者</p><p>novlan1</p><p>2025.9.3</p></div><h1 id="小程序发布指南" tabindex="-1">小程序发布指南 <a class="header-anchor" href="#小程序发布指南" aria-label="Permalink to &quot;小程序发布指南&quot;">​</a></h1><p>这里说的小程序“发布”指的是通过 <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html" target="_blank" rel="noreferrer">miniprogram-cli</a> 进行<strong>上传和预览</strong>。</p><h2 id="_1-研发平台" tabindex="-1">1. 研发平台 <a class="header-anchor" href="#_1-研发平台" aria-label="Permalink to &quot;1. 研发平台&quot;">​</a></h2><p>先简单介绍下前端研发平台，平台地址为：<a href="https://mobile.aow.com/rd-platform-web/" target="_blank" rel="noreferrer">https://mobile.aow.com/rd-platform-web/</a></p><p>主要包含CI/CD、公共组件管理、白名单管理、域名管理、COS管理等功能。</p><p>工程架构上，主要分为两级：</p><ul><li>主工程。每个 Git 仓库为一个主工程</li><li>子工程。主工程下可以有多个子工程，可以看作定制化的 <code>monorepo</code></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>- main-project</span></span>
<span class="line"><span> - src</span></span>
<span class="line"><span>  - project</span></span>
<span class="line"><span>    - sub-project</span></span></code></pre></div><h2 id="_2-小程序-ci-设计思想" tabindex="-1">2. 小程序 CI 设计思想 <a class="header-anchor" href="#_2-小程序-ci-设计思想" aria-label="Permalink to &quot;2. 小程序 CI 设计思想&quot;">​</a></h2><p>分支和流水线</p><ol><li>子工程的不同分支，会对应不同的机器人，以及独立的流水线</li><li>只有 <code>release</code> 分支可以发布正式环境，其他分支只能发布测试环境</li><li>可以接入 <a href="https://novlan1.github.io/press-plus/components/press/press-debug-popup.html" target="_blank" rel="noreferrer">debug-popup 组件</a> 进行后台环境的动态切换</li></ol><p>配置</p><ol><li>研发平台配置只是中间层，所有信息都存储在七彩石</li><li>七彩石<a href="https://rainbow.aow.com/console/7b1fbda4-dc30-4641-bab2-32e34e6435f1/Default/list?group_id=2045027&amp;group_name=devops_mp_ci&amp;tab=config" target="_blank" rel="noreferrer">配置地址</a></li></ol><p>机器人</p><ol><li>由于<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html" target="_blank" rel="noreferrer">微信侧限制</a>，机器人范围只能为<code>1-30</code></li><li>一般业务同时在测的需求应该不会超过<code>28</code>个，基本满足需求</li></ol><p>对比 H5 发布</p><table tabindex="0"><thead><tr><th><p style="width:70px;">维度</p></th><th>H5</th><th>小程序</th><th>说明</th></tr></thead><tbody><tr><td>流水线</td><td>一个工程共用一条流水线</td><td>不同子工程的不同分支，都独立一条流水线</td><td>空间换时间，构建速度更快</td></tr><tr><td>发布本质</td><td>资源上传到COS或集群</td><td>资源上传到微信后台</td><td>小程序需额外提审和发布</td></tr></tbody></table><h2 id="_3-小程序接入" tabindex="-1">3. 小程序接入 <a class="header-anchor" href="#_3-小程序接入" aria-label="Permalink to &quot;3. 小程序接入&quot;">​</a></h2><p>新的小程序接入可以按照以下步骤操作。</p><ol><li>点击工程“详情”，会看到子工程列表</li></ol><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_sT4MTQbze32MFpxw.png" width="600"><ol start="2"><li>点击子工程名称，进入子工程详情页面</li></ol><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_yJNiXWny68pwTXRB.png" width="600"><ol start="3"><li>切换到“小程序CI”页签，点击“立即接入”</li></ol><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_4rNs7CxjGJKnETS2.png" width="600"><ol start="4"><li>填写基本信息，点击确定进行提交</li></ol><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_DXS3DRfCeaQdNj47.png" width="600"><ol start="5"><li>回到子工程下“小程序CI”页签，点击&quot;新增发布&quot;</li></ol><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_enar54fQwCBfDQyE.png" width="600"><ol start="6"><li>填写机器人、分支、环境等信息</li></ol><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_Zhw54syDxJbErChH.png" width="600"><h2 id="_4-新分支接入" tabindex="-1">4. 新分支接入 <a class="header-anchor" href="#_4-新分支接入" aria-label="Permalink to &quot;4. 新分支接入&quot;">​</a></h2><p>微信限制CI机器人最多为<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html" target="_blank" rel="noreferrer">30个</a>。</p><h3 id="_4-1-新增机器人" tabindex="-1">4.1. 新增机器人 <a class="header-anchor" href="#_4-1-新增机器人" aria-label="Permalink to &quot;4.1. 新增机器人&quot;">​</a></h3><p>在当前项目接入分支数小于30个时，可以点击“新增发布”，新增分支即可。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_ZKhbfJZNGAwXzx3N.png" width="600"><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_Zhw54syDxJbErChH.png" width="600"><p>配置完成后，会生成一条唯一的流水线，并设置了当前工程、子工程、分支、机器人、发布环境等信息。</p><h3 id="_4-2-修改之前机器人" tabindex="-1">4.2. 修改之前机器人 <a class="header-anchor" href="#_4-2-修改之前机器人" aria-label="Permalink to &quot;4.2. 修改之前机器人&quot;">​</a></h3><p>如果当前子工程接入分支数已经有30个了，可以修改已经不用的分支。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_yDkxBAXAyNfw63Tx.png" width="600"><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_hfpSMDSiBHTSyM5Q.png" width="600"><h2 id="_5-小程序发布" tabindex="-1">5. 小程序发布 <a class="header-anchor" href="#_5-小程序发布" aria-label="Permalink to &quot;5. 小程序发布&quot;">​</a></h2><p>可以在“小程序CI”页签下点击“微信小程序构建”，或者“QQ小程序构建”进行构建。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_azHttCHiPJTS35hc.png" width="600"><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_8dYe4y25QhBEhryj.png" width="600"><p>构建正式环境需要填写发布原因。</p><p>⚠️ 注意，如果要真正发布小程序的话，还要在<a href="https://mp.weixin.qq.com/" target="_blank" rel="noreferrer">微信开发者后台</a>进行提审操作。</p><h2 id="_6-发布通知" tabindex="-1">6. 发布通知 <a class="header-anchor" href="#_6-发布通知" aria-label="Permalink to &quot;6. 发布通知&quot;">​</a></h2><p>发布完成后，会在CI群内有对应的通知。</p><p>通知不仅有本次发布的基本信息，还有包体积统计、二维码信息。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_Fdd64k2CR4HmeHzx.png" width="600"><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_TAJMdX8jrAhwy5CN.png" width="300"><p>接入分发插件的小程序，还有引用错误监控。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_ZMRt5em3ikE3dMy5.png" width="600">`,56)]))}const u=t(r,[["render",l]]);export{m as __pageData,u as default};

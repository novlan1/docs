import{_ as a,c as e,b as i,ag as t}from"./chunks/framework.CMjv3OHl.js";const m=JSON.parse('{"title":"上云发布删除多余文件","description":"","frontmatter":{},"headers":[],"relativePath":"work/77.delete-useless-css-while-publish.md","filePath":"work/77.delete-useless-css-while-publish.md","lastUpdated":1758424153000}'),o={name:"work/77.delete-useless-css-while-publish.md"};function p(n,s,c,l,d,h){return i(),e("div",null,s[0]||(s[0]=[t(`<div class="info custom-block"><p class="custom-block-title">作者</p><p>novlan1</p><p>2025.9.11</p></div><h1 id="上云发布删除多余文件" tabindex="-1">上云发布删除多余文件 <a class="header-anchor" href="#上云发布删除多余文件" aria-label="Permalink to &quot;上云发布删除多余文件&quot;">​</a></h1><h2 id="_1-冗余文件删除" tabindex="-1">1. 冗余文件删除 <a class="header-anchor" href="#_1-冗余文件删除" aria-label="Permalink to &quot;1. 冗余文件删除&quot;">​</a></h2><p>之前的发布，将静态文件上传CDN后，没删干净，仍然保留了CSS文件、字体文件，这次一起删除了。</p><p>效果对比如下，减少了 <code>99.2%</code> 的体积。之前：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_XbxcGHmrAnT66bse.png" width="600"><p>之后：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_JApb8JtpH4W8PkJs.png" width="600"><p>方式：</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- find &quot;\${BUILD_DESC_PATH}/&quot; -name &quot;*.js&quot; | xargs rm -rf</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- find &quot;\${BUILD_DESC_PATH}/&quot; -name &quot;*.js.map&quot; | xargs rm -rf</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- find &quot;\${BUILD_DESC_PATH}/&quot; -name &quot;*.gz&quot; | xargs rm -rf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+ find &quot;\${BUILD_DESC_PATH}/&quot; -type f -not -name &quot;*.html&quot; -print0 | xargs -0 rm -rf</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+ find ./ -type d -empty -print0 | xargs -0 rmdir</span></span></code></pre></div><p>删除多余文件后，提升了构建并推送镜像的速度，加速构建发布。</p><h2 id="_2-非必要文件不上传" tabindex="-1">2. 非必要文件不上传 <a class="header-anchor" href="#_2-非必要文件不上传" aria-label="Permalink to &quot;2. 非必要文件不上传&quot;">​</a></h2><p>另外，当前构建会将非 <code>html</code> 文件都上传到CDN中，这里其实漏了 <code>sourcemap</code> 和 <code>tar</code> 压缩文件等，这些都是没必要的。</p><p>之前配置：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_THJwEiW3JpX4DMmM.png" width="600"><p>要改成：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\.(html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tar)$</span></span></code></pre></div><h2 id="_3-存量文件处理" tabindex="-1">3. 存量文件处理 <a class="header-anchor" href="#_3-存量文件处理" aria-label="Permalink to &quot;3. 存量文件处理&quot;">​</a></h2><p>对于上云发布的历史冗余文件，需要手动删除。删除后，提升了构建速度。</p><p>以 <code>h5-test.igame.qq.com</code> 为例，镜像文件大小从之前 <code>2.9G</code> 降低到了 <code>11M</code>，节省了超 <code>99.6%</code>。</p><p>之前：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_ZGtwwD5BbKBxnK3t.png" width="400"><p>之后：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_yMaMa2pjkthr4Gdc.png" width="400"><p>发布耗时大幅缩减，以某项目为例，之前需要<code>6分42秒</code>。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_hahYNnAXKF6RN75M.png" width="600"><p>现在只需要<code>4分30秒</code>，节省了<code>132秒</code>，约 <code>32.8%</code>。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_CfsK6sYchNeeRrBc.png" width="600">`,28)]))}const u=a(o,[["render",p]]);export{m as __pageData,u as default};

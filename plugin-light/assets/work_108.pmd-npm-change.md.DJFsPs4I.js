import{_ as p,R as A,H as c,E as o,aj as n,D as a,M as s,G as e,K as d,k as l,ak as r}from"./chunks/framework.CE5Mb3x2.js";const f=JSON.parse('{"title":"PMD NPM 梳理","description":"","frontmatter":{},"headers":[],"relativePath":"work/108.pmd-npm-change.md","filePath":"work/108.pmd-npm-change.md","lastUpdated":1765646621000}'),E={name:"work/108.pmd-npm-change.md"};function m(u,t,h,g,b,k){const i=A("Mermaid");return o(),c("div",null,[t[7]||(t[7]=n('<div class="info custom-block"><p class="custom-block-title">作者</p><p>novlan1</p><p>2025.12.8</p></div><h1 id="pmd-npm-梳理" tabindex="-1">PMD NPM 梳理 <a class="header-anchor" href="#pmd-npm-梳理" aria-label="Permalink to &quot;PMD NPM 梳理&quot;">​</a></h1><h2 id="_1-依赖关系" tabindex="-1">1. 依赖关系 <a class="header-anchor" href="#_1-依赖关系" aria-label="Permalink to &quot;1. 依赖关系&quot;">​</a></h2><p>当前的依赖关系（2025.12.5）。</p>',4)),(o(),a(r,null,{default:e(()=>[l(i,{id:"mermaid-17",class:"mermaid mermaid-my-class",graph:"graph%20TD%0A%20%20widget%20--%3E%20tools%0A%20%20widget%20--%3E%20network%0A%20%20widget%20--%3E%20aegis%0A%0A%20%20vue%20--%3E%20report%0A%20%20vue%20--%3E%20tools%0A%20%20vue%20--%3E%20config%0A%20%20vue%20--%3E%20aegis%0A%20%20vue%20--%3E%20types%0A%20%20vue%20--%3E%20location%0A%20%20vue%20--%3E%20widget%0A%20%20vue%20--%3E%20network%0A%20%20vue%20--%3E%20login%0A%0A%20%20use%20--%3E%20tools%0A%20%20use%20--%3E%20widget%0A%0A%20%20tools%20--%20%E5%8F%8D%E5%90%91%20--%3E%20network%0A%20%20tools%20--%3E%20types%0A%20%20tools%20--%20%E5%8F%8D%E5%90%91%20--%3E%20vue%0A%0A%20%20report%20--%3E%20tools%0A%20%20report%20--%3E%20types%0A%20%20report%20--%3E%20config%0A%20%20report%20--%3E%20network%0A%0A%20%20pixui%20--%3E%20network%0A%20%20pixui%20--%3E%20config%0A%0A%20%20network%20--%3E%20types%0A%0A%20%20netbar%20--%3E%20tools%0A%0A%20%20login%20--%3E%20tools%0A%20%20login%20--%3E%20widget%0A%20%20login%20--%3E%20report%0A%20%20login%20--%3E%20types%0A%20%20login%20--%3E%20config%0A%20%20login%20--%3E%20network%0A%0A%20%20location%20--%3E%20widget%0A%20%20location%20--%3E%20tools%0A%20%20location%20--%3E%20network%0A%0A%20%20jsapi%20--%3E%20types%0A%20%20jsapi%20--%3E%20tools%0A%0A%20%20config%20--%3E%20types%0A%0A%20%20aegis%20--%3E%20tools%0A%0A%20%20abtest%20--%3E%20types%0A%20%20abtest%20--%3E%20network%0A%20%20abtest%20--%3E%20aegis%0A"})]),fallback:e(()=>t[0]||(t[0]=[d(" Loading... ",-1)])),_:1})),t[8]||(t[8]=s("p",null,"上面有两个反向依赖。",-1)),t[9]||(t[9]=s("img",{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/12/own_mike_DpAcihdWT3cTZr6z.png",width:"500"},null,-1)),t[10]||(t[10]=s("p",null,[d("去掉上面的反向依赖后，相对清晰一点（至少上下级关系明确了，"),s("code",null,"vue"),d(" 在最上层，"),s("code",null,"types/tools"),d(" 在下层）。")],-1)),(o(),a(r,null,{default:e(()=>[l(i,{id:"mermaid-25",class:"mermaid mermaid-my-class",graph:"graph%20TD%0A%20%20widget%20--%3E%20tools%0A%20%20widget%20--%3E%20network%0A%20%20widget%20--%3E%20aegis%0A%0A%20%20vue%20--%3E%20report%0A%20%20vue%20--%3E%20tools%0A%20%20vue%20--%3E%20config%0A%20%20vue%20--%3E%20aegis%0A%20%20vue%20--%3E%20types%0A%20%20vue%20--%3E%20location%0A%20%20vue%20--%3E%20widget%0A%20%20vue%20--%3E%20network%0A%20%20vue%20--%3E%20login%0A%0A%20%20use%20--%3E%20tools%0A%20%20use%20--%3E%20widget%0A%0A%20%20tools%20--%3E%20types%0A%0A%20%20report%20--%3E%20tools%0A%20%20report%20--%3E%20types%0A%20%20report%20--%3E%20config%0A%20%20report%20--%3E%20network%0A%0A%20%20pixui%20--%3E%20network%0A%20%20pixui%20--%3E%20config%0A%0A%20%20network%20--%3E%20types%0A%0A%20%20netbar%20--%3E%20tools%0A%0A%20%20login%20--%3E%20tools%0A%20%20login%20--%3E%20widget%0A%20%20login%20--%3E%20report%0A%20%20login%20--%3E%20types%0A%20%20login%20--%3E%20config%0A%20%20login%20--%3E%20network%0A%0A%20%20location%20--%3E%20widget%0A%20%20location%20--%3E%20tools%0A%20%20location%20--%3E%20network%0A%0A%20%20jsapi%20--%3E%20types%0A%20%20jsapi%20--%3E%20tools%0A%0A%20%20config%20--%3E%20types%0A%0A%20%20aegis%20--%3E%20tools%0A%0A%20%20abtest%20--%3E%20types%0A%20%20abtest%20--%3E%20network%0A%20%20abtest%20--%3E%20aegis%0A"})]),fallback:e(()=>t[1]||(t[1]=[d(" Loading... ",-1)])),_:1})),t[11]||(t[11]=s("p",null,[d("但还是不够清晰。更重要的是"),s("strong",null,"易变的和不变的还是没有分开"),d("。")],-1)),t[12]||(t[12]=s("p",null,"目标依赖关系：",-1)),(o(),a(r,null,{default:e(()=>[l(i,{id:"mermaid-32",class:"mermaid mermaid-my-class",graph:"graph%20TD%0A%20%20business%20--%3E%20baseSub%0A%20%20business%20--%3E%20middleSub%0A%0A%20%20middleSub%20--%3E%20baseSub%0A%0A%20%20subgraph%20baseSub%5B%20%5D%0A%20%20%20%20direction%20LR%0A%20%20%20%20network%20-.-%20config%0A%20%20%20%20config%20-.-%20tools%0A%20%20end%0A%0A%20%20subgraph%20middleSub%5B%20%5D%0A%20%20%20%20direction%20LR%0A%20%20%20%20jsapi%20-.-%20use%0A%20%20%20%20use%20-.-%20location%0A%20%20%20%20location%20-.-%20report%0A%20%20%20%20report%20-.-%20login%0A%20%20%20%20login%20-.-%20pixui%0A%20%20%20%20pixui%20%20-.-%20abtest%0A%20%20end%0A%0A%20%20linkStyle%203%2C4%2C5%2C6%2C7%2C8%2C9%2C10%20stroke-width%3A0px%0A"})]),fallback:e(()=>t[2]||(t[2]=[d(" Loading... ",-1)])),_:1})),t[13]||(t[13]=s("p",null,"模板内部的依赖关系：",-1)),(o(),a(r,null,{default:e(()=>[l(i,{id:"mermaid-36",class:"mermaid mermaid-my-class",graph:"graph%20TD%0A%20%20business%20--%3E%20location%0A%20%20business%20--%3E%20network%0A%20%20business%20--%3E%20report%0A%20%20business%20--%3E%20config%0A%20%20business%20--%3E%20login%0A%20%20business%20--%3E%20tools%0A%0A%20%20login%20--%3E%20network%0A%20%20login%20--%3E%20tools%0A%20%20login%20--%3E%20config%0A%0A%20%20location%20--%3E%20network%0A%20%20location%20--%3E%20config%0A%20%20location%20--%3E%20tools%0A%0A%20%20report%20--%3E%20network%0A%20%20report%20--%3E%20config%0A%20%20report%20--%3E%20tools%0A%0A%20%20pixui%20--%3E%20tools%0A%0A%20%20abtest%20--%3E%20tools%0A%20%20abtest%20--%3E%20network%0A%0A%0A%20%20subgraph%20base%5B%20%5D%0A%20%20%20%20network%20--%3E%20config%0A%20%20%20%20config%0A%20%20%20%20tools%0A%20%20end%0A%0A%20%20subgraph%20middle%5B%20%5D%0A%20%20%20%20jsapi%20--%3E%20tools%0A%20%20%20%20use%20--%3E%20tools%0A%20%20%20%20location%0A%20%20%20%20report%0A%20%20%20%20login%0A%20%20%20%20abtest%0A%20%20%20%20pixui%0A%20%20end%0A"})]),fallback:e(()=>t[3]||(t[3]=[d(" Loading... ",-1)])),_:1})),t[14]||(t[14]=n('<ol><li><code>types</code> 去掉，移动到对应的子包内</li><li><code>widget</code> 去掉，业务无关放到 <code>press-plus</code>，业务相关放到 <code>business</code></li><li><code>report</code> 和 <code>ageis</code> 合并</li><li><code>app-info</code> 去掉</li><li><code>use</code> 放业务无关的钩子，业务相关的放到 <code>business</code></li></ol><p>物理存储</p><ol><li><s><code>config/network</code> 拿走，放到 <code>plugin-light</code></s></li><li><s>参考模块变更频率，将 <code>tools</code> 中稳定的放到 <code>plugin-light</code>，易变的继续放到 <code>pmd-npm</code></s></li><li><s><code>location/business</code> 等不动</s></li></ol><h2 id="_2-核心思想" tabindex="-1">2. 核心思想 <a class="header-anchor" href="#_2-核心思想" aria-label="Permalink to &quot;2. 核心思想&quot;">​</a></h2><ol><li>依赖分层，避免蜘蛛网，更不允许反向依赖。维护者自己都搞不清楚，新人、使用者怎么能搞清楚？</li><li>分层，将底层的、稳定的、复用率高的拿走，中间层该合并的合并，该去掉的去掉。</li><li>用数据说话，将不变的和变化的分开</li><li>以下几种数据统计，需综合来看 <ol><li>依赖关系</li><li>变更频率</li><li>引用次数</li></ol></li></ol><h2 id="_3-参考资料" tabindex="-1">3. 参考资料 <a class="header-anchor" href="#_3-参考资料" aria-label="Permalink to &quot;3. 参考资料&quot;">​</a></h2><ul><li><a href="https://novlan1.github.io/docs/plugin-light/CONTRIBUTING.html#_3-2-%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB" target="_blank" rel="noreferrer">Plugin Light 依赖关系</a></li><li><a href="https://novlan1.github.io/docs/next-admin/change-statistics" target="_blank" rel="noreferrer">变更统计</a></li><li><a href="https://novlan1.github.io/docs/next-admin/component-statistics" target="_blank" rel="noreferrer">使用统计</a></li></ul><hr><p>2025.12.11 更新</p><hr><h2 id="_4-独立发布" tabindex="-1">4. 独立发布 <a class="header-anchor" href="#_4-独立发布" aria-label="Permalink to &quot;4. 独立发布&quot;">​</a></h2><p>每个包独立版本，也不影响任何东西。因为业务从来都是 <code>pnpm i pmd-a@latest pmd-b@latest</code>，没真正关心过具体的版本号。</p><p>另外 <code>pmd</code> 包的 <code>dependencies</code> 也没声明过其他 <code>pmd</code> 子包，说明子包内部不关心其他包的版本，只关心其他包的内容。所以升级一个内容没改变的包的版本号并没有什么好处。</p><p>本质上，不管是我们自己的业务还是其他业务，<code>pmd</code> 提供的都是一个整体服务，尽管为了方便维护将他们分成了多包。</p>',14)),(o(),a(r,null,{default:e(()=>[l(i,{id:"mermaid-163",class:"mermaid mermaid-my-class",graph:"graph%20TD%0A%20%20business%5B%E4%B8%9A%E5%8A%A1%5D%20--%3E%20pmd%5Bpmd%5D%0A%0A%20%20subgraph%20pmd%5Bpmd%5D%0A%20%20%20%20pmd-a%20-.-%20pmd-b%20-.-%20...%0A%20%20end%0A%0A%20%20linkStyle%201%2C2%20stroke-width%3A0px%0A"})]),fallback:e(()=>t[4]||(t[4]=[d(" Loading... ",-1)])),_:1})),t[15]||(t[15]=n(`<p>这一点和 <code>Press UI、Press Plus、Plugin Light</code> 中的子包是不一样的，这些是真正意义的独立子包，<code>pmd</code> 为了方便业务使用，做了权衡。</p><h2 id="_5-pnpm" tabindex="-1">5. pnpm <a class="header-anchor" href="#_5-pnpm" aria-label="Permalink to &quot;5. pnpm&quot;">​</a></h2><p>yarn 改 pnpm，发布流水线改造</p><ul><li>每个包独立发布</li><li>支持审核人</li><li>支持发布 <code>alpha/beta/patch</code> 版本</li><li>发布成功消息提醒，<code>alpha/beta</code> 同样支持</li></ul><p>之前的发布就只能指定一个分支：</p><img src="https://image-1251917893.file.myqcloud.com/next-svr/images/2025/12/own_mike_RWxc67B4HB7HsrED.png" width="500"><p>现在可以指定：</p><ul><li>分支</li><li>版本类型</li><li>发布子包</li><li>发布原因</li></ul><img src="https://image-1251917893.file.myqcloud.com/next-svr/images/2025/12/own_mike_RdSJXhfEizGEjp4F.png" width="500"><h2 id="_6-pmd-widget-改造" tabindex="-1">6. pmd-widget 改造 <a class="header-anchor" href="#_6-pmd-widget-改造" aria-label="Permalink to &quot;6. pmd-widget 改造&quot;">​</a></h2><p>业务无关的组件放到 press-plus 中，业务相关的放到 business 中。</p><p>Press Plus 有完善的文档、示例，为啥要放到 pmd 中？</p><h3 id="_6-1-总览" tabindex="-1">6.1. 总览 <a class="header-anchor" href="#_6-1-总览" aria-label="Permalink to &quot;6.1. 总览&quot;">​</a></h3><table tabindex="0"><thead><tr><th>序号</th><th>包</th><th>变更</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>toast</td><td>放到 <code>press-plus</code> 中</td><td>TS</td><td><code>pmd</code> 已做转发</td></tr><tr><td>2</td><td>dialog</td><td>放到 <code>press-plus</code> 中</td><td>TS</td><td><code>pmd</code> 已做转发</td></tr><tr><td>3</td><td>copy</td><td>放到 <code>press-plus</code> 中</td><td>TS</td><td><code>pmd</code> 已做转发</td></tr><tr><td>4</td><td>clipboard</td><td>放到 <code>press-plus</code> 中</td><td>Vue</td><td>只有<code>match-igame-admin</code>一个业务引用；<br>新业务建议直接使用copy方法，而不是组件；<br><code>pmd</code> 不处理，不再维护</td></tr><tr><td>5</td><td>marquee</td><td>放到 <code>press-plus</code> 中</td><td>Vue</td><td>新业务直接使用 <code>press-plus</code> 中的组件；<br><code>pmd</code> 不处理，不再维护</td></tr><tr><td>6</td><td>image-generator</td><td>放到 <code>press-plus</code> 中</td><td>Vue</td><td>同 <code>marquee</code></td></tr><tr><td>7</td><td>pag-animator</td><td>放到 <code>press-plus</code> 中</td><td>Vue</td><td>同 <code>marquee</code></td></tr><tr><td>8</td><td>qrcode</td><td>放到 <code>press-plus</code> 中</td><td>Vue</td><td>新业务直接使用 <code>press-ui</code> 中的组件；<br><code>pmd</code> 不处理，不再维护</td></tr><tr><td>9</td><td>video-player</td><td>放到 <code>press-plus</code> 中</td><td>Vue</td><td>同 <code>marquee</code></td></tr><tr><td>10</td><td>not-found</td><td>废弃</td><td>Vue</td><td>没一个业务使用；写的也很差</td></tr><tr><td>11</td><td>login</td><td>放到 <code>business</code> 中</td><td>Vue</td><td>-</td></tr><tr><td>12</td><td>share</td><td>放到 <code>business</code> 中</td><td>TS</td><td>-</td></tr><tr><td>13</td><td>share-v2</td><td>放到 <code>business</code> 中</td><td>TS</td><td>-</td></tr><tr><td>14</td><td>test-whitelist</td><td>放到 <code>business</code> 中</td><td>Vue</td><td>-</td></tr></tbody></table><h3 id="_6-2-toast" tabindex="-1">6.2. Toast <a class="header-anchor" href="#_6-2-toast" aria-label="Permalink to &quot;6.2. Toast&quot;">​</a></h3><p>之前的 <code>Toast</code> 放到了 <code>press-plus</code> 中，并在 <code>press-next</code> 放置了一个转发。你可以这样使用：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Toast } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;press-plus/common/toast&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 或者</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// import { Toast } from &#39;press-next/common/toast&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Toast.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">show</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello novlan1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>同时，增加了类型提示和注释，对比如下。</p><p>之前的文档提示（零提示）：</p><img src="https://image-1251917893.file.myqcloud.com/next-svr/images/2025/12/own_mike_W8K7hj8S3CAxB45P.png" width="700"><p>现在的文档提示：</p><img src="https://image-1251917893.file.myqcloud.com/next-svr/images/2025/12/own_mike_w8Bm8riMhyEiKWj2.png" width="700"><p>之前的类型提示：</p><img src="https://image-1251917893.file.myqcloud.com/next-svr/images/2025/12/own_mike_bYyH6erHCnXzsCGx.png" width="700"><p>现在的类型提示：</p><img src="https://image-1251917893.file.myqcloud.com/next-svr/images/2025/12/own_mike_cpHB7tiwhr87GPXF.png" width="700"><hr><h2 id="_7-附录" tabindex="-1">7. 附录 <a class="header-anchor" href="#_7-附录" aria-label="Permalink to &quot;7. 附录&quot;">​</a></h2><h3 id="_7-1-版本更新策略" tabindex="-1">7.1. 版本更新策略 <a class="header-anchor" href="#_7-1-版本更新策略" aria-label="Permalink to &quot;7.1. 版本更新策略&quot;">​</a></h3><p>预发布即 <code>versionType</code> 为 <code>alpha/beta/rc</code></p><p>下图 <code>type</code> 即为 <code>versionType</code></p>`,31)),(o(),a(r,null,{default:e(()=>[l(i,{id:"mermaid-537",class:"mermaid mermaid-my-class",graph:"graph%20TD%0A%20%20start%5B%E8%8E%B7%E5%8F%96%E4%B8%8B%E4%B8%80%E7%89%88%E6%9C%AC%5D%20--%3E%20isPrerelease%7Btype%20%E4%B8%BA%3Cbr%2F%3E%E9%A2%84%E5%8F%91%E5%B8%83%7D%0A%20%20isPrerelease%20--%E6%98%AF--%3E%20isPrereleaseVersionExisted%7B%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9B%B8%E5%90%8C%E7%B1%BB%E5%9E%8B%3Cbr%2F%3E%E9%A2%84%E5%8F%91%E5%B8%83%E7%89%88%E6%9C%AC%7D%0A%20%20isPrerelease%20--%E5%90%A6--%3E%20releaseVersion%5B%22inc(latest%2C%20type)%22%5D%0A%20%20isPrereleaseVersionExisted%20--%E6%98%AF--%3E%20isSmallThanLatest%7Blatest%20%E5%A4%A7%E4%BA%8E%3Cbr%2F%3E%E4%B9%8B%E5%89%8D%E9%A2%84%E5%8F%91%E5%B8%83%E7%89%88%E6%9C%AC%7D%0A%20%20isSmallThanLatest%20--%E6%98%AF--%3E%20getNextVersion%5B%22inc(latest%2C%20'prepatch'%2C%20type)%22%5D%0A%20%20isSmallThanLatest%20--%E5%90%A6--%3E%20getNextVersion2%5B%22inc(old%2C%20'prerelease'%2C%20type)%22%5D%0A%20%20isPrereleaseVersionExisted%20--%E5%90%A6--%3E%20getNextVersion3%5B%22inc(latest%2C'prerelease'%2Ctype)%22%5D%0A"})]),fallback:e(()=>t[5]||(t[5]=[d(" Loading... ",-1)])),_:1})),t[16]||(t[16]=s("h3",{id:"_7-2-版本发布流程",tabindex:"-1"},[d("7.2. 版本发布流程 "),s("a",{class:"header-anchor",href:"#_7-2-版本发布流程","aria-label":'Permalink to "7.2. 版本发布流程"'},"​")],-1)),(o(),a(r,null,{default:e(()=>[l(i,{id:"mermaid-541",class:"mermaid mermaid-my-class",graph:"graph%20LR%0A%20%20build%5BBuild%5D%20--%3E%20bump%5BBump%20Version%5D%0A%20%20bump%20--%3E%20changelog%5BChange%20Log%5D%0A%20%20changelog%20--%3E%20commit%5BCommit%5D%0A%20%20commit%20--%3E%20tag%5BTag%5D%0A%20%20tag%20--%3E%20publish%5BPublish%5D%0A%20%20publish%20--%3E%20message%5BMessage%5D%0A"})]),fallback:e(()=>t[6]||(t[6]=[d(" Loading... ",-1)])),_:1})),t[17]||(t[17]=n('<h3 id="_7-3-版本说明" tabindex="-1">7.3. 版本说明 <a class="header-anchor" href="#_7-3-版本说明" aria-label="Permalink to &quot;7.3. 版本说明&quot;">​</a></h3><table tabindex="0"><thead><tr><th>版本</th><th>发布分支</th><th>是否可以发布现网</th><th>用途</th></tr></thead><tbody><tr><td>alpha</td><td>非 master</td><td>❌</td><td>新功能、缺陷修复</td></tr><tr><td>beta</td><td>非 master</td><td>✅</td><td>验证新功能、缺陷修复，以及大改动在某一项目上试跑一段时间</td></tr><tr><td>patch</td><td>master</td><td>✅</td><td>长期稳定版本</td></tr></tbody></table>',2))])}const w=p(E,[["render",m]]);export{f as __pageData,w as default};

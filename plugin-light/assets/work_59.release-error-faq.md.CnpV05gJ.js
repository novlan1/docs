import{_ as a,c as e,b as i,ag as n}from"./chunks/framework.CMjv3OHl.js";const k=JSON.parse('{"title":"发布失败常见原因","description":"","frontmatter":{},"headers":[],"relativePath":"work/59.release-error-faq.md","filePath":"work/59.release-error-faq.md","lastUpdated":1758424153000}'),t={name:"work/59.release-error-faq.md"};function l(p,s,o,r,c,h){return i(),e("div",null,s[0]||(s[0]=[n(`<div class="info custom-block"><p class="custom-block-title">作者</p><p>novlan1</p><p>2025.8.25</p></div><h1 id="发布失败常见原因" tabindex="-1">发布失败常见原因 <a class="header-anchor" href="#发布失败常见原因" aria-label="Permalink to &quot;发布失败常见原因&quot;">​</a></h1><h2 id="_1-pnpm-lock-yaml-未同步" tabindex="-1">1. pnpm-lock.yaml 未同步 <a class="header-anchor" href="#_1-pnpm-lock-yaml-未同步" aria-label="Permalink to &quot;1. pnpm-lock.yaml 未同步&quot;">​</a></h2><p>报错如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span> ERR_PNPM_OUTDATED_LOCKFILE  Cannot install with &quot;frozen-lockfile&quot; because pnpm-lock.yaml is not up to date with &lt;ROOT&gt;/package.json</span></span>
<span class="line"><span>Note that in CI environments this setting is true by default. If you still need to run install in such cases, use &quot;pnpm install --no-frozen-lockfile&quot;</span></span>
<span class="line"><span>    Failure reason:</span></span></code></pre></div><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/8/own_mike_6ZSYbBeGwTzsFn23.png" width="600"><p>解决方法：</p><ul><li>本地执行 <code>pnpm i</code>，然后提交 <code>pnpm-lock.yaml</code></li></ul><p>查看<a href="https://devops.aow.com/console/pipeline/tip-h5/p-1e6b670b468d44feb55eb7ff618e0e6c/detail/b-1002dac8878247f18b60012b71b28a8d/executeDetail" target="_blank" rel="noreferrer">示例流水线</a>。</p><h2 id="_2-本地构建问题" tabindex="-1">2. 本地构建问题 <a class="header-anchor" href="#_2-本地构建问题" aria-label="Permalink to &quot;2. 本地构建问题&quot;">​</a></h2><p>构建失败具体原因就非常多了，比如下面这种 <code>src/component</code> 没更新的：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/8/own_mike_mRcefJHeMenG48hF.png" width="600"><p>下面是小程序下使用了不支持的语法：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/8/own_mike_sNf6y7eX56df8WbS.png" width="600"><p>下面是类型错误导致的编译失败：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_TjtrTfDXKnTThp3i.png" width="600"><p>示例流水线</p><ol><li><a href="https://devops.aow.com/console/pipeline/tip-h5/p-638294e908a74e4193e7104eca2dd69e/detail/b-0a7babc335dd4742a8e50a2f6c758757/executeDetail" target="_blank" rel="noreferrer">文件问题</a></li><li><a href="https://devops.aow.com/console/pipeline/tip-h5/p-20e9bf15e6f444c2ac74984cf0274033/detail/b-5107fc17991b4cba9913783d4a38da0d/executeDetail" target="_blank" rel="noreferrer">语法问题</a></li><li><a href="https://devops.aow.com/console/pipeline/tip-h5/p-cb8fadb8445143d992111e1ba09df04f/detail/b-f4f639e591764fd3955ecc1658065f10/executeDetail" target="_blank" rel="noreferrer">类型错误</a></li></ol><p>解决方法：</p><ul><li>本地解决问题，执行 <code>npm run build</code> 或者 <code>npm run build:mp</code> 等命令，没问题后提交</li></ul><h2 id="_3-分支名不合法" tabindex="-1">3. 分支名不合法 <a class="header-anchor" href="#_3-分支名不合法" aria-label="Permalink to &quot;3. 分支名不合法&quot;">​</a></h2><p>如果分支名中包含“<a href="https://zh.wikipedia.org/wiki/%E9%9B%B6%E5%AE%BD%E7%A9%BA%E6%A0%BC" target="_blank" rel="noreferrer">零宽空格</a>”，会导致发布失败。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_iny5iBzFG2ZtxjJ3.png" width="600"><p>下面的这个分支名称，就包含了“零宽空格”，在某些 IDE 下不可见，复制到其他地方后可见。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">feature/story-map-​whitelist​</span></span></code></pre></div><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_hHFzreYfTmwQZeFM.gif" width="500"><p>这种“零宽空格”在 <code>base64.encode</code> 时会失败，即 <code>btoa</code>，报错如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>The string to be encoded contains characters outside of the Latin1 range</span></span></code></pre></div><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_smaEdxQwDZK5e7sG.png" width="600"><p>解决方法：</p><ul><li>使用不包含“零宽空格”的新分支，重新发布</li></ul><h2 id="_4-内存溢出" tabindex="-1">4. 内存溢出 <a class="header-anchor" href="#_4-内存溢出" aria-label="Permalink to &quot;4. 内存溢出&quot;">​</a></h2><p>报错如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[1125357:0x5ba7c80]    35259 ms: Scavenge 2029.3 (2079.8) -&gt; 2024.7 (2098.1) MB, 9.01 / 0.00 ms  (average mu = 0.622, current mu = 0.479) allocation failure; </span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;--- JS stacktrace ---&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory</span></span>
<span class="line"><span>----- Native stack trace -----</span></span>
<span class="line"><span></span></span>
<span class="line"><span> 1: 0xb8ced1 node::OOMErrorHandler(char const*, v8::OOMDetails const&amp;) [/root/.nvm/versions/node/v20.18.0/bin/node]</span></span>
<span class="line"><span> 2: 0xf06460 v8::Utils::ReportOOMFailure(v8::internal::Isolate*, char const*, v8::OOMDetails const&amp;) [/root/.nvm/versions/node/v20.18.0/bin/node]</span></span>
<span class="line"><span> 3: 0xf06747 v8::internal::V8::FatalProcessOutOfMemory(v8::internal::Isolate*, char const*, v8::OOMDetails const&amp;) [/root/.nvm/versions/node/v20.18.0/bin/node]</span></span>
<span class="line"><span> 4: 0x11182e5  [/root/.nvm/versions/node/v20.18.0/bin/node]</span></span>
<span class="line"><span> 5: 0x1130168 v8::internal::Heap::CollectGarbage(v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags) [/root/.nvm/versions/node/v20.18.0/bin/node]</span></span>
<span class="line"><span> 6: 0x1106281 v8::internal::HeapAllocator::AllocateRawWithLightRetrySlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment) [/root/.nvm/versions/node/v20.18.0/bin/node]</span></span>
<span class="line"><span> 7: 0x1107415 v8::internal::HeapAllocator::AllocateRawWithRetryOrFailSlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment) [/root/.nvm/versions/node/v20.18.0/bin/node]</span></span>
<span class="line"><span> 8: 0x10e4a66 v8::internal::Factory::NewFillerObject(int, v8::internal::AllocationAlignment, v8::internal::AllocationType, v8::internal::AllocationOrigin) [/root/.nvm/versions/node/v20.18.0/bin/node]</span></span>
<span class="line"><span> 9: 0x1540896 v8::internal::Runtime_AllocateInYoungGeneration(int, unsigned long*, v8::internal::Isolate*) [/root/.nvm/versions/node/v20.18.0/bin/node]</span></span>
<span class="line"><span>10: 0x7f5493ed9ef6</span></span></code></pre></div><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_S5RxebQHHMm6yc6d.png" width="600"><p>解决方法有多种，可以在之前的 <code>build</code> 命令前加上 <code>cross-env NODE_OPTIONS=--max_old_space_size=8192</code>，如：</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- &quot;build&quot;: &quot;vue-cli-service build&quot;,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+ &quot;build&quot;: &quot;cross-env NODE_OPTIONS=--max_old_space_size=8192 vue-cli-service build&quot;,</span></span></code></pre></div><p>如果是 Vue2 项目，可以参考<a href="https://stackoverflow.com/questions/55258355/vue-clis-type-checking-service-ignores-memory-limits" target="_blank" rel="noreferrer">这里</a>，修改 <code>vue.config.js</code> 配置。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vueBaseConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getWebpackBaseConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  isUseVueLoader: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  isVue3: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  useXSS: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> merge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(someConfig, {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  chainWebpack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">plugin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fork-ts-checker&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      args[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].memoryLimit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8192</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>查看<a href="https://devops.aow.com/console/pipeline/tip-h5/p-87aaa14d7d8142d9b420f7fcc18cf6fe/detail/b-62e731f1ea1e4dbb9e9a8aa0f2daa31d/executeDetail" target="_blank" rel="noreferrer">示例流水线</a>。</p><h2 id="_5-微信小程序ci-蓝盾插件" tabindex="-1">5. “微信小程序CI”蓝盾插件 <a class="header-anchor" href="#_5-微信小程序ci-蓝盾插件" aria-label="Permalink to &quot;5. “微信小程序CI”蓝盾插件&quot;">​</a></h2><p>2025.9.15 更新</p><p><code>browserslist</code> 这个生态包在周末进行了不符合 <code>semver</code> 语义的破坏性升级（<a href="https://www.npmjs.com/package/browserslist?activeTab=versions" target="_blank" rel="noreferrer">v4.26.0</a>），造成一些报错，类似这个 issue：<a href="https://github.com/browserslist/browserslist/issues/904" target="_blank" rel="noreferrer">https://github.com/browserslist/browserslist/issues/904</a>。</p><p>锁定 <code>v4.25.4</code> 可解决，“微信小程序CI”蓝盾插件<a href="https://git.aow.com/bkdevops-plugins/miniprogrameCI/commit/c517ee0e02b9f44e405923950121ac3e4e0ffb44" target="_blank" rel="noreferrer">最新版本</a>支持。</p><p>查看<a href="https://devops.aow.com/console/pipeline/tip-h5/p-2f8175fd04d24690b137cba8bbe2fe0d/detail/b-441b257932c24ed082e3faea86eeac49/executeDetail" target="_blank" rel="noreferrer">示例流水线</a>。</p>`,45)]))}const g=a(t,[["render",l]]);export{k as __pageData,g as default};

import{_ as e,c as a,b as o,ag as d}from"./chunks/framework.CMjv3OHl.js";const p=JSON.parse('{"title":"Git 仓库文件自动同步 COS","description":"","frontmatter":{},"headers":[],"relativePath":"work/84.git-cos.md","filePath":"work/84.git-cos.md","lastUpdated":1758424153000}'),c={name:"work/84.git-cos.md"};function i(l,t,r,n,s,h){return o(),a("div",null,t[0]||(t[0]=[d('<div class="info custom-block"><p class="custom-block-title">作者</p><p>novlan1</p><p>2025.9.19</p></div><h1 id="git-仓库文件自动同步-cos" tabindex="-1">Git 仓库文件自动同步 COS <a class="header-anchor" href="#git-仓库文件自动同步-cos" aria-label="Permalink to &quot;Git 仓库文件自动同步 COS&quot;">​</a></h1><p>仓库地址：<a href="https://git.aow.com/pmd-mobile/pmd-h5/cos" target="_blank" rel="noreferrer">https://git.aow.com/pmd-mobile/pmd-h5/cos</a></p><h2 id="_1-目标" tabindex="-1">1. 目标 <a class="header-anchor" href="#_1-目标" aria-label="Permalink to &quot;1. 目标&quot;">​</a></h2><ol><li>提高效率，自动同步、自动刷新 CDN</li><li>收拢权限，提升安全性</li><li>统一管理，方便维护</li></ol><h2 id="_2-原理" tabindex="-1">2. 原理 <a class="header-anchor" href="#_2-原理" aria-label="Permalink to &quot;2. 原理&quot;">​</a></h2><h3 id="_2-1-自动同步" tabindex="-1">2.1. 自动同步 <a class="header-anchor" href="#_2-1-自动同步" aria-label="Permalink to &quot;2.1. 自动同步&quot;">​</a></h3><ol><li>监听 <code>git push</code></li><li>自动同步到 COS</li><li>自动更新 CDN 缓存</li></ol><h3 id="_2-2-自动复制" tabindex="-1">2.2. 自动复制 <a class="header-anchor" href="#_2-2-自动复制" aria-label="Permalink to &quot;2.2. 自动复制&quot;">​</a></h3><p>海外域名支持多语言自动复制，具体规则如下：</p><ol><li>将当前业务的某语言作为基准</li><li>将基准语言目录下的文件，复制到其他语言目录。当其他语言目录相应位置已有文件时，忽略</li><li>将当前域名下下所有文件，复制到国内域名下</li></ol><p>以三角洲海外来说：</p><ol><li>将 <code>cdn.dfpcevos.igame.tencent.com/os-delta-match/zh-cn</code> 复制到 <code>cdn.dfpcevos.igame.tencent.com/os-delta-match/en</code> 和 <code>cdn.dfpcevos.igame.tencent.com/os-delta-match/zh-hant</code></li><li>将 <code>cdn.dfpcevos.igame.tencent.com/os-delta-match</code> 复制到 <code>image-1251917893.file.myqcloud.com/os-delta-match</code></li></ol><p>由于历史原因，<code>cdn.nes.sgameglobal.com</code> 域名下的 HoK 赛事、商家，同步规则与上不同，具体如下：</p><ol><li>将 <code>cdn.nes.sgameglobal.com/hok-match</code> 复制到 <code>cdn.nes.sgameglobal.com/hor-match-en</code> 和 <code>cdn.nes.sgameglobal.com/hok-match-fr</code> 等等</li><li>将 <code>cdn.nes.sgameglobal.com/hor-match*</code> 复制到 <code>image-1251917893.file.myqcloud.com/hor-match*</code></li></ol><h2 id="_3-目录说明" tabindex="-1">3. 目录说明 <a class="header-anchor" href="#_3-目录说明" aria-label="Permalink to &quot;3. 目录说明&quot;">​</a></h2><p>Git 目录和 CDN 链接的对应关系如下：</p><table tabindex="0"><thead><tr><th><p style="width:100px;">Git 目录</p></th><th><p style="width:100px;">CDN 链接</p></th><th><p style="width:280px;">COS 链接</p></th><th><p style="width:100px;">对应业务</p></th></tr></thead><tbody><tr><td>cdn.dfpcevos.igame.tencent.com</td><td>cdn.dfpcevos.igame.tencent.com</td><td>cdn-1377130694.cos.ap-singapore.myqcloud.com</td><td>海外三角洲行动</td></tr><tr><td>cdn.esports.tencent.com</td><td>cdn.esports.tencent.com</td><td>cdn-esports-1320306881.cos.ap-singapore.myqcloud.com</td><td>游戏人生通用海外赛事</td></tr><tr><td>cdn.nes.sgameglobal.com</td><td>cdn.nes.sgameglobal.com</td><td>nes-pro-1310788819.cos.ap-singapore.myqcloud.com</td><td>HoK 赛事、商家</td></tr><tr><td>download.ecafe.game</td><td>download.ecafe.game</td><td>cdn-download-cos-1320306881.cos.ap-singapore.myqcloud.com</td><td>海外网吧</td></tr><tr><td>image-1251917893</td><td>image-1251917893.file.myqcloud.com</td><td>image-1251917893.cos.ap-guangzhou.myqcloud.com</td><td>国内各业务</td></tr></tbody></table><h2 id="_4-规范" tabindex="-1">4. 规范 <a class="header-anchor" href="#_4-规范" aria-label="Permalink to &quot;4. 规范&quot;">​</a></h2><p>出海业务目录规范</p><ol><li>业务目录以 <code>os-</code> 开头，比如 <code>os-delta-match</code>，方便跟国内区分</li><li>目录结构为 <code>域名/业务/语言/类型/文件</code>，如 <code>cdn.dfpcevos.igame.tencent.com/os-delta-match/zh-cn/images/xxx</code></li></ol><h2 id="_5-更新须知" tabindex="-1">5. 更新须知 <a class="header-anchor" href="#_5-更新须知" aria-label="Permalink to &quot;5. 更新须知&quot;">​</a></h2><ol><li>Git 目录与COS目录一一对应，目录结构保持一致</li><li>更新前必须确认好，避免覆盖，影响现网</li><li>必须提 MR</li><li>文件限制：2025.9.19 开始无限制</li></ol><h2 id="_6-对比-next-admin" tabindex="-1">6. 对比 Next Admin <a class="header-anchor" href="#_6-对比-next-admin" aria-label="Permalink to &quot;6. 对比 Next Admin&quot;">​</a></h2><table tabindex="0"><thead><tr><th>维度</th><th><a href="https://git.aow.com/pmd-mobile/pmd-h5/cos/" target="_blank" rel="noreferrer">Git 仓库自动同步</a></th><th><a href="https://mobile.aow.com/next-admin/image/" target="_blank" rel="noreferrer">Next Admin</a></th></tr></thead><tbody><tr><td>CDN 刷新</td><td>✅</td><td>✅</td></tr><tr><td>多语言目录复制</td><td>✅</td><td>❌</td></tr><tr><td>在线压缩</td><td>❌</td><td>✅</td></tr><tr><td>易用性</td><td>中</td><td>高</td></tr><tr><td>面向人群</td><td>研发</td><td>任何人</td></tr></tbody></table><h2 id="_7-faq" tabindex="-1">7. FAQ <a class="header-anchor" href="#_7-faq" aria-label="Permalink to &quot;7. FAQ&quot;">​</a></h2><h3 id="_7-1-如何判断是否上传成功" tabindex="-1">7.1. 如何判断是否上传成功 <a class="header-anchor" href="#_7-1-如何判断是否上传成功" aria-label="Permalink to &quot;7.1. 如何判断是否上传成功&quot;">​</a></h3><p>企业微信群有通知，或者在蓝盾查看执行记录：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_tdNDanMypbN7dhSa.png" width="500"><h3 id="_7-2-代码合并后未同步到-cos" tabindex="-1">7.2. 代码合并后未同步到 COS <a class="header-anchor" href="#_7-2-代码合并后未同步到-cos" aria-label="Permalink to &quot;7.2. 代码合并后未同步到 COS&quot;">​</a></h3><p>检查是否提交了太多文件，造成变量长度超出蓝盾限制。<a href="https://devops.aow.com/console/pipeline/tip-h5/p-13dfc9582e754af9834437e6a2244316/detail/b-ca7ef51d05c9486c8a02bf61590cb32a/executeDetail" target="_blank" rel="noreferrer">类似</a>：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_xXEshAenWEhzQ6eD.png" width="600"><p>解决方案为手动触发一次，<code>UPLOAD_ALL_FILE_FROM_DIR</code> 设置为要上传的目录名称，如 <code>image-1251917893/delta-match/css</code>：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_NzH7Rz7wmBQww6EF.png" width="600"><h3 id="_7-3-为什么不把海外项目的-cos-桶和-cdn-放一起" tabindex="-1">7.3. 为什么不把海外项目的 COS 桶和 CDN 放一起 <a class="header-anchor" href="#_7-3-为什么不把海外项目的-cos-桶和-cdn-放一起" aria-label="Permalink to &quot;7.3. 为什么不把海外项目的 COS 桶和 CDN 放一起&quot;">​</a></h3><p>方便成本分摊，及项目组要求</p><h3 id="_7-4-如何获取-cdn-链接" tabindex="-1">7.4. 如何获取 CDN 链接 <a class="header-anchor" href="#_7-4-如何获取-cdn-链接" aria-label="Permalink to &quot;7.4. 如何获取 CDN 链接&quot;">​</a></h3><p>执行 <code>npm run cdn &lt;File&gt;</code> 命令，示例如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>npm run cdn image-1251917893/igame/redirect/pc.js</span></span></code></pre></div><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_ZhycpPw7yfiwx27s.png" width="600"><h3 id="_7-5-流水线地址" tabindex="-1">7.5. 流水线地址 <a class="header-anchor" href="#_7-5-流水线地址" aria-label="Permalink to &quot;7.5. 流水线地址&quot;">​</a></h3><p><a href="https://devops.aow.com/console/pipeline/tip-h5/p-13dfc9582e754af9834437e6a2244316/history/history" target="_blank" rel="noreferrer">这里</a>。</p>',42)]))}const g=e(c,[["render",i]]);export{p as __pageData,g as default};

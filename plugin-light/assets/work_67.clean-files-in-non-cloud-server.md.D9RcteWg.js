import{_ as i,c as a,b as n,ag as p}from"./chunks/framework.CMjv3OHl.js";const c=JSON.parse('{"title":"非上云机器清理文件","description":"","frontmatter":{},"headers":[],"relativePath":"work/67.clean-files-in-non-cloud-server.md","filePath":"work/67.clean-files-in-non-cloud-server.md","lastUpdated":1757434795000}'),t={name:"work/67.clean-files-in-non-cloud-server.md"};function e(h,s,l,k,d,r){return n(),a("div",null,s[0]||(s[0]=[p(`<div class="info custom-block"><p class="custom-block-title">作者</p><p>novlan1</p><p>2025.9.4</p></div><h1 id="非上云机器清理文件" tabindex="-1">非上云机器清理文件 <a class="header-anchor" href="#非上云机器清理文件" aria-label="Permalink to &quot;非上云机器清理文件&quot;">​</a></h1><p>之前非上云的构建流程有问题，<code>tar</code> 打包是在 <code>build</code> 过程中，在之后对静态文件进行上传CDN以及删除本地文件后，没有再次打包，导致真正发布的还是以前的 <code>tar</code> 文件，进而导致机器上静态文件巨多，磁盘爆满。</p><h2 id="_1-优化" tabindex="-1">1. 优化 <a class="header-anchor" href="#_1-优化" aria-label="Permalink to &quot;1. 优化&quot;">​</a></h2><p>解决办法，在上传CDN、删除本地文件后，重新进行打包。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -cvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> light-dist.tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span></code></pre></div><h2 id="_2-效果" tabindex="-1">2. 效果 <a class="header-anchor" href="#_2-效果" aria-label="Permalink to &quot;2. 效果&quot;">​</a></h2><p>对比一下，之前发布一次，机器增加15M文件。同时，发布重复分支，文件一样增加。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_GfRBwzd6RMijbz6R.png" width="600"><p>现在发布一次，机器只增加16K文件。并且，发布重复分支，文件大小基本不变（只有 <code>index.html</code>）。</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_4TfaZkYJwtKzEyKE.png" width="600"><p>删除之前的文件：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/website/userweb/htdocs/tip/ingame-page/feature</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看下当前文件大小</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">du</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 先打印</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -maxdepth</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;.&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -print</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 排除几个分支后删除</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -maxdepth</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;.&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;goods-money-wx&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;goods-compliance-phone-unbind&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;goods-use-reward&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;back-to-act&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;gp-act-page&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +</span></span></code></pre></div><p>看看机器上磁盘大小：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 发布目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">du</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --max-depth=1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/website/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">df</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -TH</span></span></code></pre></div><p>之前：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_dX3G4KcyPZaCnE4b.png" width="600"><br><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_pdXMPEb6RRapbc37.png" width="600"><p>现在：</p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_zwkWswTGtWRB3DW2.png" width="600"><br><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_z68dKa6cE5TsecKD.png" width="600"><h2 id="_3-其他" tabindex="-1">3. 其他 <a class="header-anchor" href="#_3-其他" aria-label="Permalink to &quot;3. 其他&quot;">​</a></h2><p>在这里申请 bf 权限登录</p><p><a href="https://bf.aow.com/#/permissionApply/permissionApply" target="_blank" rel="noreferrer">https://bf.aow.com/#/permissionApply/permissionApply</a></p><img src="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2025/9/own_mike_yDs3F8pBPTFn6eAB.png" width="500"><p>权限通过后，用 <code>WETERM</code> 上登录 <code>mnet2</code>，登录之后输入 <code>bf list</code>，如果只有一个权限的话，直接就会进入目标机器。</p><p>输入 <code>ifconfig</code> 可以验证 <code>ip</code> 是否符合预期。</p>`,29)]))}const F=i(t,[["render",e]]);export{c as __pageData,F as default};

import{P as e}from"./press-popup-plus.BG5D9r4L.js";import{_ as t,M as n,ad as a,L as i,c as s,f as o,ah as r,r as u,o as l,d as c,h as m}from"./index-DdqTp3oi.js";import{P as h,p}from"./press-picker-plus.BjnQBL0j.js";const d=(e,t)=>"yearMonth"===e?function(e){const{year:t,month:n}=g(e);return"".concat(t,"/").concat(n)}(t):t,y="yearMonth-day-hour-minute",f="yearMonth";function g(e){const t=e%12,n=parseInt("".concat((e-t)/12),10);return t?{year:n,month:t}:{year:n-1,month:12}}const C=(new Date).getFullYear();function k(e,t,n){return Math.min(Math.max(e,t),n)}function x(e){return"00".concat(e).slice(-2)}function P(e){for(void 0===e&&(e="1");isNaN(parseInt(e,10));)e=e.slice(1);return parseInt(e,10)}function D(e,t){return 32-new Date(e,t-1,32).getDate()}const M=t({name:"PressDatetimePickerPopupPlus",components:{PressPopupPlus:e,PressDatetimePicker:t({name:"PressDatetimePicker",options:{...n,styleIsolation:"shared"},components:{PressPicker:h},props:Object.assign(Object.assign({},p),{...i,value:{type:null},filter:{type:[Function,null],default:null},type:{type:String,default:"datetime"},showToolbar:{type:Boolean,default:!0},formatter:{type:[Function,null],default:d},minDate:{type:Number,default:new Date(C-10,0,1).getTime()},maxDate:{type:Number,default:new Date(C+10,11,31).getTime()},minHour:{type:Number,default:0},maxHour:{type:Number,default:23},minMinute:{type:Number,default:0},maxMinute:{type:Number,default:59},immediateCheck:{type:Boolean,default:!1},activeClass:{type:String,default:""},toolbarClass:{type:String,default:""},columnClass:{type:String,default:""},useMomentum:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3}}),emits:["input","input","cancel","confirm","input","change"],data:()=>({innerValue:Date.now(),columns:[]}),watch:{value:{handler(){this.updateValue()}},type:{handler(){this.updateValue()}},minDate:{handler(){this.updateValue()}},maxDate:{handler(){this.updateValue()}},minHour:{handler(){this.updateValue()}},maxHour:{handler(){this.updateValue()}},minMinute:{handler(){this.updateValue()}},maxMinute:{handler(){this.updateValue()}}},mounted(){const e=this.correctValue(this.value);this.updateColumnValue(e).then((()=>{this.immediateCheck?this.onChange():this.$emit("input",e)}))},methods:{setData(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))},set(e){return this.setData(e),new Promise((e=>a(e)))},updateValue(){const e=this.correctValue(this.value),t=e===this.innerValue;this.updateColumnValue(e).then((()=>{t||this.$emit("input",e)}))},getPicker(){if(null==this.picker){this.picker=this.$refs.pressPicker;const{picker:e}=this,{setColumnValues:t}=e;e.setColumnValues=(...n)=>t.apply(e,[...n,!1])}return this.picker},updateColumns(){const e=this.formatter||d,t=this.getOriginColumns().map((t=>({values:t.values.map((n=>e(t.type,n,this.innerValue)))})));return this.set({columns:t})},getOriginColumns(){const{filter:e,innerValue:t}=this;return this.getRanges().map((({type:n,range:a})=>{let i=function(e,t){let n=0;const a=Array(e<0?0:e);for(;n<e;)a[n]=t(n),n+=1;return a}(a[1]-a[0]+1,(e=>{const t=a[0]+e;return"year"===n||n===f?"".concat(t):x(t)}));return e&&(i=e(n,i,t)),{type:n,values:i}}))},getRanges(){if("time"===this.type)return[{type:"hour",range:[this.minHour,this.maxHour]},{type:"minute",range:[this.minMinute,this.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:n,maxHour:a,maxMinute:i,maxYearMonth:s}=this.getBoundary("max",this.innerValue),{minYear:o,minDate:r,minMonth:u,minHour:l,minMinute:c,minYearMonth:m}=this.getBoundary("min",this.innerValue),h=[{type:"year",range:[o,e]},{type:"month",range:[u,n]},{type:"day",range:[r,t]},{type:"hour",range:[l,a]},{type:"minute",range:[c,i]}];if("date"===this.type&&h.splice(3,2),"year-month"===this.type&&h.splice(2,3),this.type===y){return[{type:f,range:[m,s]},{type:"day",range:[r,t]},{type:"hour",range:[l,a]},{type:"minute",range:[c,i]}]}return h},correctValue(e){const t="time"!==this.type;if(t&&(!r(n=e)||isNaN(new Date(n).getTime())))e=this.minDate;else if(!t&&!e){const{minHour:t}=this;e="".concat(x(t),":00")}var n;if(!t){let[t,n]=e.split(":");return t=x(k(t,this.minHour,this.maxHour)),n=x(k(n,this.minMinute,this.maxMinute)),"".concat(t,":").concat(n)}return e=Math.max(e,this.minDate),e=Math.min(e,this.maxDate)},getBoundary(e,t){const n=new Date(t),a=new Date(this["".concat(e,"Date")]),i=a.getFullYear();let s=1,o=1,r=0,u=0;"max"===e&&(s=12,o=D(n.getFullYear(),n.getMonth()+1),r=23,u=59),n.getFullYear()===i&&(s=a.getMonth()+1,n.getMonth()+1===s&&(o=a.getDate(),n.getDate()===o&&(r=a.getHours(),n.getHours()===r&&(u=a.getMinutes()))));const l=12*i+s;return{["".concat(e,"Year")]:i,["".concat(e,"Month")]:s,["".concat(e,"Date")]:o,["".concat(e,"Hour")]:r,["".concat(e,"Minute")]:u,["".concat(e,"YearMonth")]:l}},onCancel(){this.$emit("cancel")},onConfirm(){this.$emit("confirm",this.innerValue)},onChange(){let e;const t=this.getPicker(),n=this.getOriginColumns();if("time"===this.type){const a=t.getIndexes();e="".concat(+n[0].values[a[0]],":").concat(+n[1].values[a[1]])}else{const a=t.getIndexes().map(((e,t)=>n[t].values[e]));let i=P(a[0]),s=P(a[1]);const o=D(i,s);let r=P(a[2]);"year-month"===this.type&&(r=1),r=r>o?o:r;let u=0,l=0;if("datetime"===this.type&&(u=P(a[3]),l=P(a[4])),this.type===y){const e=g(a[0]);i=e.year,s=e.month,r=P(a[1]),u=P(a[2]),l=P(a[3])}e=new Date(i,s-1,r,u,l)}e=this.correctValue(e),this.updateColumnValue(e).then((()=>{this.$emit("input",e),this.$emit("change",t)}))},updateColumnValue(e){let t=[];const{type:n,innerValue:a}=this,i=this.formatter||d,s=this.getPicker();if("time"===n){const n=e.split(":");t=[i("hour",n[0],a),i("minute",n[1])]}else{const s=new Date(e);t=[i("year","".concat(s.getFullYear()),a),i("month",x(s.getMonth()+1),a)],"date"===n&&t.push(i("day",x(s.getDate()),a)),"datetime"===n&&t.push(i("day",x(s.getDate()),a),i("hour",x(s.getHours()),a),i("minute",x(s.getMinutes()),a)),n===y&&(t=[i(f,12*s.getFullYear()+s.getMonth()+1,a),i("day",x(s.getDate()),a),i("hour",x(s.getHours()),a),i("minute",x(s.getMinutes()),a)])}return this.set({innerValue:e}).then((()=>this.updateColumns())).then((()=>s.setValues(t)))}}},[["render",function(e,t,n,a,i,r){const c=u("PressPicker");return l(),s("div",{class:"press-datetime-picker-index"},[o(c,{ref:"pressPicker",class:"press-datetime-picker","active-class":e.activeClass,"toolbar-class":e.toolbarClass,"column-class":e.columnClass,title:e.title,columns:i.columns,"item-height":e.itemHeight,"show-toolbar":e.showToolbar,"visible-item-count":e.visibleItemCount,"confirm-button-text":e.confirmButtonText,"cancel-button-text":e.cancelButtonText,"use-momentum":e.useMomentum,"swipe-duration":e.swipeDuration,onChange:r.onChange,onConfirm:r.onConfirm,onCancel:r.onCancel},null,8,["active-class","toolbar-class","column-class","title","columns","item-height","show-toolbar","visible-item-count","confirm-button-text","cancel-button-text","use-momentum","swipe-duration","onChange","onConfirm","onCancel"])])}]])},props:{show:{type:Boolean,default:!1},closeOnClickOverlay:{type:Boolean,default:!0},datetimePicker:{type:Object,default:()=>({})},formatter:{type:[Function,null],default:d},filter:{type:[Function,null],default:null},zIndex:{type:Number,default:100}},data:()=>({}),methods:{input(e){this.$emit("input",e)},cancel(...e){this.$emit("cancel",...e)},confirm(...e){this.$emit("confirm",...e)},clickOverlay(){this.$emit("click-overlay")}}},[["render",function(e,t,n,a,i,s){const r=u("PressDatetimePicker"),h=u("PressPopupPlus");return l(),c(h,{show:n.show,"z-index":n.zIndex,position:"bottom","close-on-click-overlay":n.closeOnClickOverlay,onClickOverlay:s.clickOverlay,onClose:s.cancel},{default:m((()=>[o(r,{value:n.datetimePicker.value,"show-toolbar":n.datetimePicker.showToolbar||!1,"item-height":n.datetimePicker.itemHeight||56,type:n.datetimePicker.type||"datetime","max-date":n.datetimePicker.maxDate,"min-date":n.datetimePicker.minDate,"immediate-check":n.datetimePicker.immediateCheck,title:n.datetimePicker.title||"",formatter:n.formatter,filter:n.filter,onInput:s.input,onCancel:s.cancel,onConfirm:s.confirm},null,8,["value","show-toolbar","item-height","type","max-date","min-date","immediate-check","title","formatter","filter","onInput","onCancel","onConfirm"])])),_:1},8,["show","z-index","close-on-click-overlay","onClickOverlay","onClose"])}]]);export{M as P};

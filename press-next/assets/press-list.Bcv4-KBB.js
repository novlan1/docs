import{aZ as e,a_ as t,_ as l,L as s,aT as o,aL as i,M as n,a8 as r,ad as a,d as c,h,i as d,n as u,S as f,r as p,o as g,b as m,J as y,a as S,f as v,j as w,e as L}from"./index-DdqTp3oi.js";import{S as _}from"./scroll-view.Bd72usm9.js";const C=/scroll|auto|overlay/i;function k(e,t){void 0===t&&(t=window);let l=e;for(;l&&"HTML"!==l.tagName&&"BODY"!==l.tagName&&1===l.nodeType&&l!==t;){const{overflowY:e}=window.getComputedStyle(l);if(C.test(e))return l;l=l.parentNode}return t}function b(e){let t=e;return e.startsWith("#")||(t="#".concat(e)),t="".concat(t," > .uni-scroll-view > .uni-scroll-view"),t}let x=0;function B(l){const s="binded_".concat(x);function o(){const e=this;e[s]||(l.call(e,t,!0),e[s]=!0)}function i(){const t=this;t[s]&&(l.call(t,e,!1),t[s]=!1)}return x+=1,{mounted:o,activated:o,deactivated:i,beforeDestroy:i}}const T="scrollViewId",I=b(T);const V=l({name:"PressList",options:{...n},components:{PressLoadingPlus:i},mixins:[o,B((function(e){this.autoCheckScroller&&(this.scroller||(this.scroller=k(this.$el)),e(this.scroller,"scroll",this.onScroll,!0),e(this.scroller,"touchmove",this.onScroll,!0),this.onScroll())})),_],props:{offset:{type:[Number,String],default:50},finished:{type:Boolean,default:!1},finishedText:{type:String,default:""},loadingText:{type:String,default:"加载中..."},immediateCheck:{type:Boolean,default:!0},enableFlex:{type:Boolean,default:!1},enhanced:{type:Boolean,default:!1},scrollWithAnimation:{type:Boolean,default:!1},enablePassive:{type:Boolean,default:!1},scrollAnchoring:{type:Boolean,default:!1},scrollToElementById:{type:String,default:""},vertical:{type:Boolean,default:!0},loadingStyle:{type:String,default:""},loadingSize:{type:String,default:"20px"},finishedStyle:{type:String,default:""},autoCheckScroller:{type:Boolean,default:!1},scrollLeft:{type:[Number,String],default:0},scrollTop:{type:[Number,String],default:0},...s,customStyle:{type:String,default:""}},emits:["scroll","input","load","update:modelValue"],data(){return{innerLoading:this.realModelValue,SCROLL_VIEW_ID:T,scrollerHeight:0}},computed:{scrollViewClass(){return["press-list",this.vertical?"press-list--vertical":"press-list--hor",this.customClass].join(" ")},scrollViewStyle(){return"height: 100%; ".concat(this.customStyle,";")}},watch:{realModelValue:{handler(e){this.innerLoading=e,this.check()}},finished:"check"},mounted(){this.immediateCheck&&this.check()},updated(){},methods:{getScrollerHeight(){this.scrollerHeight||r(this,I).then((e=>{this.scrollerHeight=e.height}))},scroll(e){this.getScrollerHeight(),this.$emit("scroll",e,this.scrollerHeight),this.check()},scrollToLower(){this.emitInput()},emitInput(){this.innerLoading||this.finished||(this.innerLoading=!0,this.emitModelValue(!0),this.$emit("load"))},check(){a((()=>{this.innerCheck()}))},innerCheck(){this.autoCheckScroller||this.commonCheck()},commonCheck(e){const{offset:t}=this;this.innerLoading||this.finished||Promise.all([r(this,".press-list__placeholder"),r(this,I)]).then((l=>{const{0:s,1:o}=l;if(void 0===e&&(e=o),this.innerLoading||this.finished)return;if(!(e.bottom-e.top))return;let i=s.bottom-e.bottom;this.vertical||(i=s.right-e.right);i<=t&&this.emitInput()})).catch((()=>{})).finally((()=>{}))},onScroll(){const{scroller:e,autoCheckScroller:t}=this;if(!t)return;let l;(null==e?void 0:e.getBoundingClientRect)&&(l=e.getBoundingClientRect()),this.commonCheck(l)}}},[["render",function(e,t,l,s,o,i){const n=p("PressLoadingPlus"),r=f;return g(),c(r,{id:o.SCROLL_VIEW_ID,style:u(i.scrollViewStyle),"scroll-y":l.vertical,"scroll-x":!l.vertical,"scroll-with-animation":l.scrollWithAnimation,"scroll-anchoring":l.scrollAnchoring,enhanced:l.enhanced,"enable-flex":l.enableFlex,"enable-passive":l.enablePassive,"lower-threshold":l.offset,"scroll-into-view":l.scrollToElementById,class:d(i.scrollViewClass),"scroll-top":l.scrollTop,"scroll-left":l.scrollLeft,onScrolltolower:i.scrollToLower,onScroll:i.scroll},{default:h((()=>[m("div",{class:"press-list__layout"},[y(e.$slots,"default",{},void 0,!0),o.innerLoading?y(e.$slots,"loading",{key:0},(()=>[m("div",{class:"press-list__loading",style:u(l.loadingStyle)},[v(n,{vertical:!l.vertical,size:l.loadingSize},{default:h((()=>[w(L(l.loadingText),1)])),_:1},8,["vertical","size"])],4)]),!0):S("",!0),l.finishedText&&l.finished?y(e.$slots,"finished",{key:1},(()=>[m("div",{class:"press-list__finished",style:u(l.finishedStyle)},[m("div",null,L(l.finishedText),1)],4)]),!0):S("",!0),m("div",{class:"press-list__placeholder"})])])),_:3},8,["id","style","scroll-y","scroll-x","scroll-with-animation","scroll-anchoring","enhanced","enable-flex","enable-passive","lower-threshold","scroll-into-view","class","scroll-top","scroll-left","onScrolltolower","onScroll"])}],["__scopeId","data-v-30d25f16"]]);export{B,V as P,b as a,k as g};

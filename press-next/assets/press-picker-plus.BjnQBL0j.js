import{ag as t,af as e,_ as s,L as i,b1 as n,M as o,b2 as r,ad as l,b3 as a,c as u,b as c,n as m,F as h,l as d,w as p,i as f,o as g,j as y,e as x,t as v,a as C,b4 as b,aL as I,d as k,f as S,r as T}from"./index-DdqTp3oi.js";import{r as _}from"./number.BhcN_qOs.js";import{S as H}from"./scroll-view.Bd72usm9.js";function w(t){const e=typeof t;return null!==t&&("object"===e||"function"===e)}const P={optionText:function(t,e){return w(t)&&null!=t[e]?t[e]:t},optionTextHtml:function(t){return w(t)&&t.html},rootStyle:function(s){return e({height:t(s.itemHeight*s.visibleItemCount)})},wrapperStyle:function(s){const i=t(s.offset+s.itemHeight*(s.visibleItemCount-1)/2);return e({transition:"transform ".concat(s.duration,"ms"),"line-height":t(s.itemHeight),transform:"translate3d(0, ".concat(i,", 0)")})}};const V=s({name:"PressPickerColumn",options:{...o},mixins:[H],...n(a),props:{...i,activeClass:{type:String,default:""},valueKey:{type:String,default:""},className:{type:String,default:""},itemHeight:{type:Number,default:44},visibleItemCount:{type:Number,default:6},initialOptions:{type:Array,default:()=>[]},defaultIndex:{type:Number,default:0},useMomentum:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3}},emits:["change"],data:()=>({startY:0,offset:0,duration:0,startOffset:0,options:[],currentIndex:0,computed:P,touchStartTime:0,momentumOffset:0}),computed:{columnStyle(){const{itemHeight:t,visibleItemCount:e}=this;return P.rootStyle({itemHeight:t,visibleItemCount:e})},wrapperStyle(){const{offset:t,itemHeight:e,visibleItemCount:s,duration:i}=this;return P.wrapperStyle({offset:t,itemHeight:e,visibleItemCount:s,duration:i})}},watch:{defaultIndex:{handler(t){this.setIndex(t)},immediate:!0},initialOptions:{handler(t){this.options=t,this.setIndex(this.defaultIndex)},deep:!0}},created(){const{defaultIndex:t,initialOptions:e}=this;this.set({currentIndex:t,options:e}).then((()=>{this.setIndex(t)})),this[a].children.push(this)},methods:{setData(t){Object.keys(t).forEach((e=>{this[e]=t[e]}))},getCount(){return this.options.length},set(t){return this.setData(t),new Promise((t=>l(t)))},onTouchStart(t){this.setData({startY:t.touches[0].clientY,startOffset:this.offset,duration:0,touchStartTime:Date.now(),momentumOffset:this.offset})},onTouchMove(t){if(!t.touches[0])return;const e=t.touches[0].clientY-this.startY,s=_(this.startOffset+e,-this.getCount()*this.itemHeight,this.itemHeight);this.setData({offset:s});const i=Date.now();i-this.touchStartTime>300&&(this.touchStartTime=i,this.momentumOffset=s)},getIndexByOffset(t){return _(Math.round(-t/this.itemHeight),0,this.getCount()-1)},momentum(t,e){const s=Math.abs(t/e),i=this.offset+s/.003*(t<0?-1:1),n=this.getIndexByOffset(i);this.setData({duration:+this.swipeDuration}),this.setIndex(n,!0)},onTouchEnd(){if(this.offset===this.startOffset)return;const t=this.offset-this.momentumOffset,e=Date.now()-this.touchStartTime;if(e<300&&Math.abs(t)>15&&this.useMomentum)return void this.momentum(t,e);this.setData({duration:200});const s=this.getIndexByOffset(this.offset);this.setIndex(s,!0)},onClickItem(t){const{index:e}=t.currentTarget.dataset;this.setIndex(e,!0)},adjustIndex(t){const e=this.getCount();for(let s=t=_(t,0,e);s<e;s++)if(!this.isDisabled(this.options[s]))return s;for(let s=t-1;s>=0;s--)if(!this.isDisabled(this.options[s]))return s},isDisabled:t=>r(t)&&t.disabled,getOptionText(t){return r(t)&&this.valueKey in t?t[this.valueKey]:t},setIndex(t,e){const s=-(t=this.adjustIndex(t)||0)*this.itemHeight;return t!==this.currentIndex?this.set({offset:s,currentIndex:t}).then((()=>{e&&this.$emit("change",t)})):this.set({offset:s})},setValue(t){const{options:e}=this;for(let s=0;s<e.length;s++)if(this.getOptionText(e[s])===t)return this.setIndex(s);return Promise.resolve()},getValue(){return this.options[this.currentIndex]}}},[["render",function(t,e,s,i,n,o){return g(),u("div",{class:"press-picker-column-index"},[c("div",{class:f(["press-picker-column",t.customClass]),style:m(o.columnStyle),onTouchstart:e[1]||(e[1]=(...t)=>o.onTouchStart&&o.onTouchStart(...t)),onTouchmove:e[2]||(e[2]=p(((...t)=>o.onTouchMove&&o.onTouchMove(...t)),["stop","prevent"])),onTouchend:e[3]||(e[3]=(...t)=>o.onTouchEnd&&o.onTouchEnd(...t)),onTouchcancel:e[4]||(e[4]=(...t)=>o.onTouchEnd&&o.onTouchEnd(...t))},[c("div",{style:m(o.wrapperStyle),class:"press-picker-column__wrapper"},[(g(!0),u(h,null,d(n.options,((t,i)=>(g(),u("div",{key:t.index,"data-index":i,style:m({height:"".concat(s.itemHeight,"px"),lineHeight:"".concat(s.itemHeight,"px")}),class:f(["press-ellipsis","press-picker-column__item",{"press-picker-column__item--disabled":t&&t.disabled,"press-picker-column__item--selected":i===n.currentIndex,activeClass:i===n.currentIndex}]),onClick:e[0]||(e[0]=(...t)=>o.onClickItem&&o.onClickItem(...t))},[n.computed.optionTextHtml(t)?(g(),u("div",{key:0,class:"press-picker-column__item-html",innerHTML:n.computed.optionTextHtml(t)},null,8,["innerHTML"])):(g(),u(h,{key:1},[y(x(n.computed.optionText(t,s.valueKey)),1)],64))],14,["data-index"])))),128))],4)],38)])}],["__scopeId","data-v-e37ba625"]]);const O=s({options:{styleIsolation:"shared"},props:{title:{type:String,default:""},showToolbar:Boolean,cancelButtonText:{type:String,default:v("picker.cancel")},confirmButtonText:{type:String,default:v("picker.confirm")},customClass:{type:String,default:""}},methods:{emit(...t){this.$emit("emit",...t)}}},[["render",function(t,e,s,i,n,o){return g(),u("div",{class:f(["press-picker-toolbar",s.customClass])},[s.showToolbar?(g(),u("div",{key:0,class:"press-picker__toolbar toolbar-class"},[c("div",{class:"press-picker__cancel","hover-class":"press-picker__cancel--hover","hover-stay-time":"70","data-type":"cancel",onClick:e[0]||(e[0]=(...t)=>o.emit&&o.emit(...t))},x(s.cancelButtonText),1),s.title?(g(),u("div",{key:0,class:"press-picker__title press-ellipsis"},x(s.title),1)):C("",!0),c("div",{class:"press-picker__confirm","hover-class":"press-picker__confirm--hover","hover-stay-time":"70","data-type":"confirm",onClick:e[1]||(e[1]=(...t)=>o.emit&&o.emit(...t))},x(s.confirmButtonText),1)])):C("",!0)],2)}],["__scopeId","data-v-1443ade1"]]),B={title:{type:String,default:""},showToolbar:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},cancelButtonText:{type:String,default:v("picker.cancel")},confirmButtonText:{type:String,default:v("picker.confirm")},visibleItemCount:{type:Number,default:6},itemHeight:{type:[Number,String],default:44}};const D={columnsStyle:function(s){return e({height:t(s.itemHeight*s.visibleItemCount)})},frameStyle:function(s){return e({height:t(s.itemHeight)})},maskStyle:function(s){return e({"background-size":"100% ".concat(t(s.itemHeight*(s.visibleItemCount-1)/2))})},columns:function(t){return Array.isArray(t)?t.length&&!t[0].values?[{values:t}]:t:[]}};const E=s({name:"PressPickerPlus",options:{...o},components:{PickerColumn:V,Loading:I,ToolBar:O},...b(a),props:{...i,...B,valueKey:{type:String,default:"text"},toolbarPosition:{type:String,default:"top"},defaultIndex:{type:Number,default:0},columns:{type:Array,default:()=>[]},activeClass:{type:String,default:""},toolbarClass:{type:String,default:""},columnClass:{type:String,default:""},useMomentum:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3}},emits:["change","confirm","cancel"],data:()=>({simple:!0}),computed:{columnStyle(){const{itemHeight:t,visibleItemCount:e}=this;return D.columnsStyle({itemHeight:t,visibleItemCount:e})},maskStyle(){const{itemHeight:t,visibleItemCount:e}=this;return D.maskStyle({itemHeight:t,visibleItemCount:e})},frameStyle(){const{itemHeight:t}=this;return D.frameStyle({itemHeight:t})},computedColumns(){const{columns:t}=this;return D.columns(t)}},watch:{columns:{handler(t=[]){this.simple=t.length&&!t[0].values,Array.isArray(this.children)&&this.children.length&&this.setColumns().catch((()=>{}))},immediate:!0}},beforeCreate(){},created(){this.children=[]},mounted(){Array.isArray(this.children)&&this.children.length&&this.setColumns().catch((()=>{}))},methods:{noop(){},setColumns(){const t=(this.simple?[{values:this.columns}]:this.columns).map(((t,e)=>this.setColumnValues(e,t.values)));return Promise.all(t)},emit(t){const{type:e}=t.currentTarget.dataset;this.simple?this.$emit(e,{value:this.getColumnValue(0),index:this.getColumnIndex(0)}):this.$emit(e,{value:this.getValues(),index:this.getIndexes()})},onChange(t,e){this.simple?this.$emit("change",{value:this.getColumnValue(0),index:this.getColumnIndex(0)}):this.$emit("change",{value:this.getValues(),index:e})},getColumn(t){return this.children[t]},getColumnValue(t){const e=this.getColumn(t);return e&&e.getValue()},setColumnValue(t,e){const s=this.getColumn(t);return null==s?Promise.reject(new Error("setColumnValue: 对应列不存在")):s.setValue(e)},getColumnIndex(t){return(this.getColumn(t)||{}).currentIndex},setColumnIndex(t,e){const s=this.getColumn(t);return null==s?Promise.reject(new Error("setColumnIndex: 对应列不存在")):s.setIndex(e)},getColumnValues(t){return(this.children[t]||{}).options},setColumnValues(t,e,s=!0){const i=this.children[t];if(null==i)return Promise.reject(new Error("setColumnValues: 对应列不存在"));return JSON.stringify(i.options)===JSON.stringify(e)?Promise.resolve():i.set({options:e}).then((()=>{s&&i.setIndex(0)}))},getValues(){return this.children.map((t=>t.getValue()))},setValues(t){const e=t.map(((t,e)=>this.setColumnValue(e,t)));return Promise.all(e)},getIndexes(){return this.children.map((t=>t.currentIndex))},setIndexes(t){const e=t.map(((t,e)=>this.setColumnIndex(e,t)));return Promise.all(e)},resetColumn(t,e=0){const s=this.getColumn(t);if(null==s)return Promise.reject(new Error("setColumnValue: 对应列不存在"));s.setIndex(e)}}},[["render",function(t,e,s,i,n,o){const r=T("ToolBar"),l=T("Loading"),a=T("PickerColumn");return g(),u("div",{class:"press-picker-index"},[c("div",{class:f(["press-picker",t.customClass])},["top"===s.toolbarPosition?(g(),k(r,{key:0,title:t.title,"show-toolbar":t.showToolbar,"cancel-button-text":t.cancelButtonText,"confirm-button-text":t.confirmButtonText,"custom-class":s.toolbarClass,onEmit:o.emit},null,8,["title","show-toolbar","cancel-button-text","confirm-button-text","custom-class","onEmit"])):C("",!0),t.loading?(g(),u("div",{key:1,class:"press-picker__loading"},[S(l,{color:"#1989fa"})])):C("",!0),c("div",{class:"press-picker__columns",style:m(o.columnStyle),onTouchmove:e[0]||(e[0]=p(((...t)=>o.noop&&o.noop(...t)),["stop","prevent"]))},[(g(!0),u(h,null,d(o.computedColumns,((e,i)=>(g(),k(a,{ref_for:!0,ref:"pickerColumn",key:i,class:"press-picker__column","data-index":i,"custom-class":s.columnClass,"value-key":s.valueKey,"initial-options":e.values,"default-index":e.defaultIndex||s.defaultIndex,"item-height":t.itemHeight,"visible-item-count":t.visibleItemCount,"active-class":s.activeClass,"use-momentum":s.useMomentum,"swipe-duration":s.swipeDuration,onChange:t=>o.onChange(t,i)},null,8,["data-index","custom-class","value-key","initial-options","default-index","item-height","visible-item-count","active-class","use-momentum","swipe-duration","onChange"])))),128)),c("div",{class:"press-picker__mask",style:m(o.maskStyle)},null,4),c("div",{class:"press-picker__frame press-hairline--top-bottom",style:m(o.frameStyle)},null,4)],36),"bottom"===s.toolbarPosition?(g(),k(r,{key:2,"custom-class":s.toolbarClass},null,8,["custom-class"])):C("",!0)],2)])}],["__scopeId","data-v-c7527c45"]]);export{E as P,B as p};
